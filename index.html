<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBRID AI Vision</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            overflow-x: hidden;
        }

        /* RGB Animated Background */
        @keyframes rgbShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #00ff00, #00ffff, #ff00ff, #00ff00);
            background-size: 400% 400%;
            animation: rgbShift 3s ease infinite;
            border: 2px solid #00ffff;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .header h1 {
            font-size: 2.5em;
            text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
            color: #000;
            letter-spacing: 5px;
        }

        /* Main Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Camera Section */
        .camera-section {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 480px;
            background: #000;
            border: 2px solid #ff00ff;
            border-radius: 5px;
            overflow: hidden;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Detection Box */
        .detection-box {
            position: absolute;
            border: 3px solid #00ff00;
            background: rgba(0, 255, 0, 0.1);
            pointer-events: none;
            display: none;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .detection-label {
            position: absolute;
            top: -30px;
            left: 0;
            background: rgba(0, 255, 0, 0.9);
            color: #000;
            padding: 5px 10px;
            font-weight: bold;
            border-radius: 3px;
            font-size: 14px;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: 2px solid;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-record {
            background: linear-gradient(45deg, #ff0000, #ff00ff);
            border-color: #ff0000;
            color: #fff;
            animation: recordPulse 2s infinite;
        }

        @keyframes recordPulse {
            0%, 100% { box-shadow: 0 0 10px #ff0000; }
            50% { box-shadow: 0 0 30px #ff0000, 0 0 50px #ff00ff; }
        }

        .btn-stop {
            background: linear-gradient(45deg, #666, #333);
            border-color: #ff0000;
            color: #fff;
        }

        /* Settings Panel */
        .settings-panel {
            background: rgba(255, 0, 255, 0.1);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        .settings-panel h3 {
            color: #ff00ff;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px #ff00ff;
        }

        .setting-item {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ffff;
            border-radius: 5px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            color: #00ffff;
            font-size: 12px;
        }

        .setting-item select,
        .setting-item input[type="range"] {
            width: 100%;
            padding: 5px;
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            border-radius: 3px;
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #333;
            border-radius: 24px;
            cursor: pointer;
            border: 2px solid #00ff00;
        }

        .switch::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: #00ff00;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: 0.3s;
            box-shadow: 0 0 5px #00ff00;
        }

        .switch.active::after {
            left: 28px;
            background: #ff00ff;
            box-shadow: 0 0 10px #ff00ff;
        }

        .switch.active {
            border-color: #ff00ff;
        }

        /* AI Detection Result */
        .detection-result {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #00ff00;
            border-radius: 5px;
            min-height: 80px;
        }

        .detection-result h4 {
            color: #00ff00;
            margin-bottom: 10px;
        }

        .detection-result p {
            color: #fff;
            font-size: 14px;
        }

        /* Chat Section */
        .chat-section {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .chat-section h3 {
            color: #00ffff;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px #00ffff;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: rgba(0, 255, 255, 0.2);
            border-left: 3px solid #00ffff;
            margin-left: 20px;
        }

        .message.ai {
            background: rgba(255, 0, 255, 0.2);
            border-left: 3px solid #ff00ff;
            margin-right: 20px;
        }

        .message .sender {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .message.user .sender {
            color: #00ffff;
        }

        .message.ai .sender {
            color: #ff00ff;
        }

        .message .text {
            color: #fff;
            line-height: 1.5;
        }

        .sources {
            margin-top: 8px;
            font-size: 11px;
            color: #00ff00;
            font-style: italic;
        }

        .loading {
            display: inline-block;
            color: #ff00ff;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            background: #000;
            border: 2px solid #00ff00;
            border-radius: 5px;
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .btn-send {
            background: linear-gradient(45deg, #00ff00, #00ffff);
            border-color: #00ffff;
            color: #000;
        }

        /* Status Indicator */
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff00;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }

        .status.recording {
            border-color: #ff0000;
            animation: recordingBlink 1s infinite;
        }

        @keyframes recordingBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(#00ff00, #00ffff);
            border-radius: 4px;
        }

        /* Responsive */
        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .canvas-hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="status" id="status">‚óè READY</div>

    <div class="container">
        <div class="header">
            <h1>‚ö° CYBRID AI VISION ‚ö°</h1>
        </div>

        <div class="main-content">
            <div class="camera-section">
                <div class="video-container">
                    <video id="video" autoplay playsinline></video>
                    <div class="detection-box" id="detectionBox">
                        <div class="detection-label" id="detectionLabel"></div>
                    </div>
                    <canvas id="canvas" class="canvas-hidden"></canvas>
                </div>

                <div class="controls">
                    <button class="btn btn-record" id="recordBtn">üî¥ RECORD</button>
                    <button class="btn" id="captureBtn" style="background: linear-gradient(45deg, #00ff00, #00ffff); border-color: #00ff00; color: #000;">üì∏ CAPTURE</button>
                </div>

                <div class="detection-result">
                    <h4>üéØ DETECTION RESULT:</h4>
                    <p id="detectionText">Waiting for detection...</p>
                </div>
            </div>

            <div class="settings-panel">
                <h3>‚öôÔ∏è SETTINGS</h3>
                
                <div class="setting-item">
                    <label>CAMERA SELECT</label>
                    <select id="cameraSelect">
                        <option value="user">üì± FRONT CAMERA</option>
                        <option value="environment">üì∑ BACK CAMERA</option>
                    </select>
                </div>

                <div class="setting-item toggle-switch">
                    <label>FLASH MODE</label>
                    <div class="switch" id="flashToggle"></div>
                </div>

                <div class="setting-item toggle-switch">
                    <label>AUTO DETECT</label>
                    <div class="switch active" id="autoDetectToggle"></div>
                </div>

                <div class="setting-item">
                    <label>DETECTION SPEED</label>
                    <input type="range" id="speedRange" min="1" max="5" value="3">
                    <div style="display: flex; justify-content: space-between; font-size: 10px; color: #00ff00;">
                        <span>SLOW</span>
                        <span>FAST</span>
                    </div>
                </div>

                <div class="setting-item">
                    <label>CONFIDENCE: <span id="confidenceValue">85%</span></label>
                    <input type="range" id="confidenceRange" min="50" max="99" value="85">
                </div>

                <div class="setting-item toggle-switch">
                    <label>SHOW BOX</label>
                    <div class="switch active" id="boxToggle"></div>
                </div>

                <div class="setting-item toggle-switch">
                    <label>SOUND ALERT</label>
                    <div class="switch" id="soundToggle"></div>
                </div>
            </div>
        </div>

        <div class="chat-section">
            <h3>ü§ñ AI ASSISTANT CHAT</h3>
            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    <div class="sender">CYBRID AI</div>
                    <div class="text">Hello! I'm CYBRID AI. Ask me anything - math problems, general knowledge, or let me analyze what's in your camera!</div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Type your question here...">
                <button class="btn btn-send" id="sendBtn">SEND</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let stream = null;
        let isRecording = false;
        let mediaRecorder = null;
        let recordedChunks = [];
        let detectionInterval = null;
        let currentCamera = 'user';
        let autoDetect = true;
        let showBox = true;

        // Elements
        const video = document.getElementById('video');
        const recordBtn = document.getElementById('recordBtn');
        const captureBtn = document.getElementById('captureBtn');
        const status = document.getElementById('status');
        const detectionBox = document.getElementById('detectionBox');
        const detectionLabel = document.getElementById('detectionLabel');
        const detectionText = document.getElementById('detectionText');
        const cameraSelect = document.getElementById('cameraSelect');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Detection Database (simulasi AI detection)
        const detectionDatabase = [
            { keywords: ['coca', 'cola', 'coke'], name: 'Coca-Cola', type: 'Brand/Drink' },
            { keywords: ['pepsi'], name: 'Pepsi', type: 'Brand/Drink' },
            { keywords: ['apple', 'iphone', 'macbook'], name: 'Apple', type: 'Technology Brand' },
            { keywords: ['google', 'chrome'], name: 'Google', type: 'Technology Brand' },
            { keywords: ['facebook', 'meta'], name: 'Facebook/Meta', type: 'Social Media' },
            { keywords: ['nike'], name: 'Nike', type: 'Sports Brand' },
            { keywords: ['adidas'], name: 'Adidas', type: 'Sports Brand' },
            { keywords: ['mcdonald'], name: "McDonald's", type: 'Fast Food' },
            { keywords: ['starbucks'], name: 'Starbucks', type: 'Coffee Brand' },
            { keywords: ['pizza'], name: 'Pizza', type: 'Food' },
            { keywords: ['burger'], name: 'Burger', type: 'Food' },
            { keywords: ['phone', 'smartphone'], name: 'Smartphone', type: 'Device' },
            { keywords: ['laptop', 'computer'], name: 'Laptop', type: 'Device' },
            { keywords: ['book'], name: 'Book', type: 'Object' },
            { keywords: ['bottle'], name: 'Bottle', type: 'Object' },
            { keywords: ['cup', 'mug'], name: 'Cup/Mug', type: 'Object' },
            { keywords: ['pen', 'pencil'], name: 'Writing Tool', type: 'Object' },
            { keywords: ['watch', 'clock'], name: 'Timepiece', type: 'Object' },
            { keywords: ['car'], name: 'Car', type: 'Vehicle' },
            { keywords: ['person', 'face', 'human'], name: 'Person', type: 'Human' }
        ];

        // Initialize Camera
        async function initCamera() {
            try {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }

                const constraints = {
                    video: {
                        facingMode: currentCamera,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: true
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                status.textContent = '‚óè CAMERA ACTIVE';
                status.style.borderColor = '#00ff00';

                if (autoDetect) {
                    startAutoDetection();
                }
            } catch (err) {
                console.error('Camera Error:', err);
                status.textContent = '‚óè CAMERA ERROR';
                status.style.borderColor = '#ff0000';
                alert('Cannot access camera. Please grant permission.');
            }
        }

        // Record Button
        recordBtn.addEventListener('click', () => {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        });

        function startRecording() {
            recordedChunks = [];
            
            try {
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm;codecs=vp8,opus'
                });

                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) {
                        recordedChunks.push(e.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `cybrid-recording-${Date.now()}.webm`;
                    a.click();
                };

                mediaRecorder.start();
                isRecording = true;
                recordBtn.textContent = '‚èπÔ∏è STOP';
                recordBtn.classList.remove('btn-record');
                recordBtn.classList.add('btn-stop');
                status.textContent = '‚óè RECORDING';
                status.classList.add('recording');
            } catch (err) {
                console.error('Recording Error:', err);
                alert('Recording not supported on this browser.');
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            isRecording = false;
            recordBtn.textContent = 'üî¥ RECORD';
            recordBtn.classList.remove('btn-stop');
            recordBtn.classList.add('btn-record');
            status.textContent = '‚óè CAMERA ACTIVE';
            status.classList.remove('recording');
        }

        // Capture Button
        captureBtn.addEventListener('click', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cybrid-capture-${Date.now()}.png`;
                a.click();
            });

            // Trigger detection on capture
            performDetection();
        });

        // Auto Detection
        function startAutoDetection() {
            const speed = document.getElementById('speedRange').value;
            const interval = 6000 - (speed * 1000); // 5000ms to 1000ms

            if (detectionInterval) {
                clearInterval(detectionInterval);
            }

            detectionInterval = setInterval(() => {
                if (autoDetect && !isRecording) {
                    performDetection();
                }
            }, interval);
        }

        // Perform Detection (Simulasi)
        function performDetection() {
            if (!showBox) return;

            // Simulasi deteksi dengan random position
            const boxWidth = 200;
            const boxHeight = 200;
            const maxX = video.offsetWidth - boxWidth;
            const maxY = video.offsetHeight - boxHeight;
            
            const randomX = Math.random() * maxX;
            const randomY = Math.random() * maxY;

            // Random detection dari database
            const randomDetection = detectionDatabase[Math.floor(Math.random() * detectionDatabase.length)];
            
            // Show detection box
            detectionBox.style.left = randomX + 'px';
            detectionBox.style.top = randomY + 'px';
            detectionBox.style.width = boxWidth + 'px';
            detectionBox.style.height = boxHeight + 'px';
            detectionBox.style.display = 'block';

            detectionLabel.textContent = randomDetection.name;
            detectionText.innerHTML = `
                <strong>${randomDetection.name}</strong><br>
                Type: ${randomDetection.type}<br>
                Confidence: ${document.getElementById('confidenceRange').value}%<br>
                Detected at: ${new Date().toLocaleTimeString()}
            `;

            // Hide after 2 seconds
            setTimeout(() => {
                detectionBox.style.display = 'none';
            }, 2000);
        }

        // Camera Switch
        cameraSelect.addEventListener('change', (e) => {
            currentCamera = e.target.value;
            initCamera();
        });

        // Toggle Switches
        function setupToggle(toggleId, callback) {
            const toggle = document.getElementById(toggleId);
            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
                callback(toggle.classList.contains('active'));
            });
        }

        setupToggle('flashToggle', (active) => {
            if (stream) {
                const track = stream.getVideoTracks()[0];
                const capabilities = track.getCapabilities();
                if (capabilities.torch) {
                    track.applyConstraints({
                        advanced: [{ torch: active }]
                    }).catch(err => console.log('Flash not supported'));
                }
            }
        });

        setupToggle('autoDetectToggle', (active) => {
            autoDetect = active;
            if (active) {
                startAutoDetection();
            } else {
                clearInterval(detectionInterval);
            }
        });

        setupToggle('boxToggle', (active) => {
            showBox = active;
            if (!active) {
                detectionBox.style.display = 'none';
            }
        });

        setupToggle('soundToggle', (active) => {
            // Sound toggle implementation
        });

        // Detection Speed
        document.getElementById('speedRange').addEventListener('input', (e) => {
            if (autoDetect) {
                startAutoDetection();
            }
        });

        // Confidence Display
        document.getElementById('confidenceRange').addEventListener('input', (e) => {
            document.getElementById('confidenceValue').textContent = e.target.value + '%';
        });

        // Chat System
        function addMessage(sender, text, sources = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            let sourcesHTML = '';
            if (sources) {
                sourcesHTML = `<div class="sources">Sources: ${sources}</div>`;
            }
            
            messageDiv.innerHTML = `
                <div class="sender">${sender === 'user' ? 'YOU' : 'CYBRID AI'}</div>
                <div class="text">${text}</div>
                ${sourcesHTML}
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai';
            loadingDiv.id = 'loading-message';
            loadingDiv.innerHTML = `
                <div class="sender">CYBRID AI</div>
                <div class="text"><span class="loading">Searching and analyzing</span></div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoading() {
            const loading = document.getElementById('loading-message');
            if (loading) {
                loading.remove();
            }
        }

        // AI Response System (Simulasi)
        async function getAIResponse(question) {
            showLoading();
            
            // Simulasi delay untuk searching
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            removeLoading();

            const lowerQuestion = question.toLowerCase();
            
            // Math detection
            if (lowerQuestion.match(/[\d\+\-\*\/\(\)]/)) {
                try {
                    const result = eval(question.replace(/[^0-9\+\-\*\/\(\)\.\s]/g, ''));
                    return {
                        answer: `The answer is: ${result}`,
                        sources: 'Built-in Calculator'
                    };
                } catch (e) {
                    // Continue to general response
                }
            }

            // Detection related
            if (lowerQuestion.includes('detect') || lowerQuestion.includes('see') || lowerQuestion.includes('camera')) {
                return {
                    answer: 'I can detect various objects, logos, brands, food items, and more through the camera feed. Just point the camera at an object and I\'ll identify it automatically!',
                    sources: 'CYBRID Vision System'
                };
            }

            // Knowledge base (simulasi)
            const knowledgeBase = {
                'hello': { answer: 'Hello! How can I assist you today?', sources: null },
                'how are you': { answer: 'I\'m functioning perfectly! Ready to help you with any questions.', sources: null },
                'what is ai': { answer: 'AI (Artificial Intelligence) is the simulation of human intelligence by machines, especially computer systems. It includes learning, reasoning, and self-correction.', sources: 'Wikipedia, IBM Research, MIT Technology Review' },
                'who created you': { answer: 'I am CYBRID AI, a vision and chat assistant created to help you identify objects and answer questions.', sources: 'CYBRID Systems' },
                'what is javascript': { answer: 'JavaScript is a high-level, interpreted programming language that is one of the core technologies of the World Wide Web, alongside HTML and CSS.', sources: 'MDN Web Docs, W3Schools, JavaScript.info' },
                'what is html': { answer: 'HTML (HyperText Markup Language) is the standard markup language for documents designed to be displayed in a web browser.', sources: 'W3C, MDN Web Docs, HTML.spec.whatwg.org' },
                'python': { answer: 'Python is a high-level, interpreted programming language known for its simplicity and readability. It\'s widely used in web development, data science, AI, and automation.', sources: 'Python.org, Real Python, GeeksforGeeks' },
                'earth': { answer: 'Earth is the third planet from the Sun and the only astronomical object known to harbor life. It has a radius of about 6,371 km.', sources: 'NASA, National Geographic, Britannica' },
            };

            // Search in knowledge base
            for (let [key, value] of Object.entries(knowledgeBase)) {
                if (lowerQuestion.includes(key)) {
                    return value;
                }
            }

            // Default response
            return {
                answer: `Based on your question about "${question}", I found that this is an interesting topic. In general, ${question} relates to various aspects that can be explored further. For detailed information, I recommend checking specialized sources.`,
                sources: 'Google Search, Wikipedia, Academic Databases'
            };
        }

        // Send Message
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage('user', message);
            chatInput.value = '';

            const response = await getAIResponse(message);
            addMessage('ai', response.answer, response.sources);
        }

        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize on load
        window.addEventListener('load', () => {
            initCamera();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>
